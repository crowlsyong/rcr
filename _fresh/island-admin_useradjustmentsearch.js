import{a as O}from"./chunk-ZGK2NUGW.js";import{a as U}from"./chunk-DT2WSX4O.js";import"./chunk-DGI52A4N.js";import"./chunk-URWAKGWD.js";import{a as t}from"./chunk-MEABNXAK.js";import{a as l,b as h,c as x,e as c}from"./chunk-NGSZJRVL.js";import{d as v}from"./chunk-V66ALGLP.js";function D({debouncedUsername:n,onUserOverviewFetched:i,isLoadingParent:b,refreshTrigger:m,onTableRefreshNeeded:S}){let[j,u]=l(!1),[e,d]=l(null),[f,o]=l(null),E=x(!1);h(()=>{if(E.current){if(typeof window<"u"){let s=new URL(globalThis.location.href);n?s.searchParams.set("q",n):s.searchParams.delete("q"),globalThis.history.replaceState(null,"",s.toString())}}else E.current=!0},[n]);let p=c(async s=>{d(null),o(null),u(!0),console.log("[UserAdjustmentSearch] Fetching data for:",s);try{let a=await fetch(`/api/v0/credit-score?username=${s}`),r=await a.json();if(!a.ok||!r.userExists){let y=r.error||`User @${s} not found.`;o(y),i(null),console.error("[UserAdjustmentSearch] Fetch failed:",s,y);return}let g={userExists:r.userExists,fetchSuccess:r.fetchSuccess,userId:r.userId,username:r.username,avatarUrl:r.avatarUrl,creditScore:r.creditScore,riskBaseFee:r.riskBaseFee,userDeleted:r.userDeleted,existingOverrideEvents:r.overrideEvents||[]};d(g),i(g),console.log("[UserAdjustmentSearch] User data fetched:",g)}catch(a){let r=`Error fetching user data: ${typeof a=="object"&&a!==null&&"message"in a?a.message:String(a)}`;o(r),i(null),console.error("[UserAdjustmentSearch] Fetch error:",a)}finally{u(!1)}},[i]);h(()=>{if(console.log("[UserAdjustmentSearch] Data fetch effect triggered. Debounced username:",n,"Refresh Trigger:",m),!n){d(null),o(null),i(null),u(!1);return}p(n)},[n,m,p]);let A=c(()=>{console.log("[UserAdjustmentSearch] Override deletion successful. Notifying parent to refresh."),S()},[S]),w=c(s=>{e&&i({...e,modifyingEvent:s})},[e,i]);return t(v,{children:[j&&t("p",{class:"text-gray-400 text-sm mt-2",children:"Loading user data..."}),f&&t("p",{class:"text-red-400 text-sm mt-2",children:f}),e&&!f&&t(v,{children:[t("div",{class:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[t("h3",{class:"text-lg font-semibold text-white mb-2",children:"Current User Status:"}),t(U,{username:e.username,creditScore:e.creditScore,riskBaseFee:e.riskBaseFee,avatarUrl:e.avatarUrl,isWaiting:!1,userExists:e.userExists,fetchSuccess:e.fetchSuccess,isEmptyInput:!1,userDeleted:e.userDeleted})]}),t(O,{overrideEvents:e.existingOverrideEvents,userId:e.userId,username:e.username,isLoadingParent:b,onDeleteSuccess:A,onModify:w})]})]})}export{D as default};
