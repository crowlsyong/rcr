async function c(r,n,a=2,t=1e3){for(let e=0;e<=a;e++)try{let s=await fetch(r,n);if(s.ok)return{response:s,success:!0,error:null};if((s.status===503||s.status===500||s.status===502||s.status===504||s.status===429)&&e<a){console.warn(`Fetch failed for ${r} with status ${s.status}. Retrying in ${t*(e+1)}ms... (Attempt ${e+1} of ${a+1})`),await new Promise(i=>setTimeout(i,t*(e+1)));continue}let o=s.statusText||`Request failed with status ${s.status}`;return{response:s,success:!1,error:new Error(o)}}catch(s){let o=typeof s=="object"&&s!==null&&"message"in s?s.message:String(s);if(e<a){console.warn(`Fetch error for ${r}: ${o}. Retrying in ${t*(e+1)}ms... (Attempt ${e+1} of ${a+1})`),await new Promise(i=>setTimeout(i,t*(e+1)));continue}return console.error(`Fetch error for ${r} after ${a+1} attempts: ${o}`),{response:null,error:new Error(o),success:!1}}return{response:null,error:new Error("Fetch retries exhausted unexpectedly or logic error."),success:!1}}var l="https://api.manifold.markets/v0";async function g(r){let n=!1,{response:a,success:t,error:e}=await c(`${l}/user/${r}`);if(!t||!a)return console.warn(`fetchUserData: Failed to fetch data for '${r}' after retries. Error: ${typeof e=="object"&&e!==null&&"message"in e?e.message:String(e)}`),{userData:null,fetchSuccess:!1,userDeleted:n};if(a.status===404)return console.info(`fetchUserData: User '${r}' not found (404).`),{userData:null,fetchSuccess:!1,userDeleted:n};if(!a.ok)return console.warn(`fetchUserData: Received non-OK status ${a.status} for '${r}' after retries.`),{userData:null,fetchSuccess:!1,userDeleted:n};try{let s=await a.json();return n=s.userDeleted===!0,console.debug(`fetchUserData: Successfully fetched data for '${r}'.`),{userData:s,fetchSuccess:!0,userDeleted:n}}catch(s){return console.error(`fetchUserData: Error parsing JSON for '${r}': ${typeof s=="object"&&s!==null&&"message"in s?s.message:String(s)}`),{userData:null,fetchSuccess:!1,userDeleted:n}}}async function m(r){let{response:n,success:a,error:t}=await c(`${l}/slug/${r}`);if(!a||!n)return console.warn(`getMarketDataBySlug: Failed to fetch market data for slug '${r}' after retries. Error: ${typeof t=="object"&&t!==null&&"message"in t?t.message:String(t)}`),{data:null,error:`Network/fetch error for slug '${r}'.`};if(!n.ok){let e=await n.text();return console.warn(`getMarketDataBySlug: Received non-OK status ${n.status} for slug '${r}': ${e}`),{data:null,error:`Failed to fetch market data for '${r}': ${n.status} ${n.statusText} - ${e}`}}try{let e=await n.json();return typeof e.id!="string"||typeof e.question!="string"||typeof e.url!="string"||typeof e.volume!="number"||typeof e.slug!="string"||typeof e.outcomeType!="string"?{data:null,error:`Invalid or incomplete market data received for slug '${r}'.`}:{data:e,error:null}}catch(e){return console.error(`getMarketDataBySlug: Error parsing JSON for slug '${r}': ${typeof e=="object"&&e!==null&&"message"in e?e.message:String(e)}`),{data:null,error:`Error parsing market data for slug '${r}'.`}}}async function d(r,n){let a=`${l}/comments?contractId=${r}`;n&&(a+=`&userId=${n}`),a+="&order=newest",a+="&limit=1000";let{response:t,success:e,error:s}=await c(a);if(!e||!t)return{success:!1,data:null,error:`Network or fetch error: ${typeof s=="object"&&s!==null&&"message"in s?s.message:String(s)}`};if(!t.ok){let o=await t.text();return console.error(`Manifold API GET comments error: ${t.status} ${t.statusText} - ${o}`),{success:!1,data:null,error:`Failed to fetch comments (${t.status}): ${o||t.statusText}`}}try{return{success:!0,data:await t.json(),error:null}}catch(o){return console.error(`Error parsing JSON for comments: ${typeof o=="object"&&o!==null&&"message"in o?o.message:String(o)}`),{success:!1,data:null,error:"Error parsing comments data"}}}export{g as a,m as b,d as c};
