import{a as E}from"./chunk-3SQ5UUFP.js";import{a as U}from"./chunk-2ZV2IV35.js";import"./chunk-CRCKSX74.js";import"./chunk-GI7LLYGM.js";import{a as T}from"./chunk-I6W4WTVW.js";import"./chunk-HNGXSQHJ.js";import{a as k}from"./chunk-DT2WSX4O.js";import"./chunk-DGI52A4N.js";import"./chunk-URWAKGWD.js";import{a as e}from"./chunk-MEABNXAK.js";import{a as l,b,c as D,e as C}from"./chunk-NGSZJRVL.js";import{d as R}from"./chunk-V66ALGLP.js";function F(){return typeof globalThis.location>"u"?"":new URLSearchParams(globalThis.location.search).get("q")||""}function M(n,t){if(t==="ALL"||n.length===0)return n;let c=Date.now(),r;switch(t){case"7D":r=c-7*24*60*60*1e3;break;case"30D":r=c-30*24*60*60*1e3;break;case"90D":r=c-90*24*60*60*1e3;break;case"6M":r=c-6*30*24*60*60*1e3;break;default:return n}return n.filter(d=>d.timestamp>=r)}function B(){let n=F(),[t,c]=l(n),[r,d]=l(!1),[m,i]=l(null),[a,u]=l(null),[S,f]=l([]),[x,I]=l("30D"),g=D(null),w=D(!1),H=C(o=>{c(o),u(null),f([]),i(null)},[]);b(()=>{if(w.current){if(typeof window<"u"){let o=new URL(globalThis.location.href);t?o.searchParams.set("q",t):o.searchParams.delete("q"),globalThis.history.replaceState(null,"",o.toString())}}else w.current=!0},[t]),b(()=>{async function o(h){if(d(!0),i(null),u(null),f([]),!h){d(!1);return}try{let s=await fetch(`/api/v0/credit-score?username=${h}`);if(!s.ok){i(`Failed to fetch current score data: ${s.statusText}`);return}let p=await s.json();if(u(p),!p.userExists){i(`User '${h}' not found on Manifold Markets.`),u(null);return}if(!p.userId){i(`User '${h}' found, but user ID is missing. Cannot fetch history.`);return}let y=await fetch(`/api/v0/history?userId=${p.userId}`);if(!y.ok)console.error(`Failed to fetch historical data: ${y.statusText}`),i("Failed to fetch historical data.");else{let P=await y.json();f(P)}}catch(s){console.error("Error fetching data for chart:",s),i(`Could not load data: ${typeof s=="object"&&s!==null&&"message"in s?s.message:String(s)}`)}finally{d(!1)}}t?o(t):t===""&&(d(!1),i(null),u(null),f([]))},[t]),b(()=>{!r&&t&&g.current&&document.activeElement!==g.current&&g.current.focus()},[r,t]);let L=M(S,x),v=r&&!!t;return e("div",{class:"bg-gray-900 p-6 rounded-lg shadow-xl border border-gray-700",children:[e("h1",{class:"text-2xl font-bold mb-6 text-white",children:"\u{1F99D}Credit Score Chart"}),e("div",{class:"flex items-end space-x-2",children:e("div",{class:"flex-grow",children:e(U,{initialValue:n,onDebouncedChange:H,isFetching:r,inputRef:g})})}),v&&e("p",{class:"text-center text-gray-400 py-8",children:"Loading data..."}),m&&t&&e("p",{class:"text-center text-red-500 py-8",children:m}),!t&&!v&&!m&&e("p",{class:"text-center text-gray-400 py-8",children:"Enter a username above to see their credit score chart."}),t&&!v&&!m&&a&&a.userExists?e(R,{children:[e(k,{username:a.username,creditScore:a.creditScore,riskBaseFee:a.riskBaseFee,avatarUrl:a.avatarUrl,isWaiting:!1}),e("div",{class:"mt-6",children:e("div",{class:"bg-gray-900 p-4 md:p-6 rounded-lg shadow-inner",children:[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-4",children:[e("h2",{class:"text-xl font-semibold text-gray-100 mb-2 md:mb-0",children:"Score History"}),S.length>0&&e(E,{selectedRange:x,onRangeChange:I})]}),e(T,{username:t,historicalData:L,selectedTimeRange:x,isLoading:!1,error:null,overrideEvents:a?.overrideEvents||[]})]})}),e("div",{class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-200",children:[e("div",{class:"bg-gray-900 p-4 md:p-6 rounded-lg shadow-inner",children:[e("h2",{class:"text-xl font-semibold mb-3 text-gray-100",children:"Current Score Details"}),e("p",{class:"text-sm md:text-base",children:["RISK Base Fee: ",e("strong",{children:a.riskBaseFee})]}),e("p",{class:"text-sm md:text-base",children:["Latest League Rank:"," ",e("strong",{children:a.details?.latestRank??"N/A"})]}),e("p",{class:"text-sm md:text-base",children:["Calculated Profit:"," ",e("strong",{children:Math.round(a.details?.calculatedProfit)})]}),e("p",{class:"text-sm md:text-base",children:["Approximate Balance:"," ",e("strong",{children:Math.round(a.details?.balance)})]})]}),e("div",{class:"bg-gray-900 p-4 md:p-6 rounded-lg shadow-inner",children:[e("h2",{class:"text-xl font-semibold mb-3 text-gray-100",children:"Notes"}),e("p",{class:"text-xs md:text-sm text-gray-400",children:"The historical data updates at most every 24 hours. The current score displayed above reflects the latest data from RISK. It creates a datapoint whenever a score is fetched, so long as 24 hours have elapsed since the last datapoint was created. This is extremely experimental and may completely fail to work. Hehe!"}),a?.historicalDataSaved&&e("p",{class:"text-xs md:text-sm text-green-500 mt-2",children:"Historical data point saved during this request."})]})]})]}):null]})}export{B as default};
