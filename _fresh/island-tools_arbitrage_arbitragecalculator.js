import{a as L}from"./chunk-HJ23KSZB.js";import{a as U}from"./chunk-24YMHNYZ.js";import{a as T}from"./chunk-PHONPTCU.js";import{a as D}from"./chunk-47AFDEP3.js";import{a as $}from"./chunk-2K2R6GYV.js";import{a as s}from"./chunk-MEABNXAK.js";import{a as M,b as Y}from"./chunk-NGSZJRVL.js";import{d as R}from"./chunk-V66ALGLP.js";function v(t,e,a){if(a<=e)return{cost:0,shares:0};let d=Math.sqrt(t*(1-e)/e),r=Math.sqrt(t*e/(1-e)),n=Math.sqrt(t*(1-a)/a),l=Math.sqrt(t*a/(1-a))-r,o=d-n;return{cost:l,shares:o}}function B(t,e,a){if(a>=e)return{cost:0,shares:0};let d=Math.sqrt(t*(1-e)/e),r=Math.sqrt(t*e/(1-e)),n=Math.sqrt(t*(1-a)/a),i=Math.sqrt(t*a/(1-a)),l=n-d,o=r-i;return{cost:l,shares:o}}function F(t,e,a){if(t.outcomeType!=="BINARY"||e.outcomeType!=="BINARY"||!t.pool||!e.pool||t.probability===void 0||e.probability===void 0)return{result:null,error:"Both markets must be BINARY"};if(t.pool.YES<=0||t.pool.NO<=0||e.pool.YES<=0||e.pool.NO<=0)return{result:null,error:"Market pools must be positive for accurate calculations: Try markets with more liquidity"};switch(a){case"balanced":return K(t,e);case"horseRace":return j(t,e);case"oneSided":return G(t,e);case"average":return W(t,e);default:return{result:null,error:`Invalid calculation mode: ${a}`}}}function K(t,e){let a=t.pool.YES*t.pool.NO,d=e.pool.YES*e.pool.NO,r=t.probability,n=e.probability;if(r>=n)return{result:{marketA:t,marketB:e,betAmountA:0,betAmountB:0,profit:0,newProbability:(r+n)/2,betOutcomeA:"YES",betOutcomeB:"NO"},error:`For 'balanced' mode, Market A probability (${(r*100).toFixed(1)}%) must be lower than Market B probability (${(n*100).toFixed(1)}%) for a meaningful calculation`};let i=r,l=n,o=h=>{let u=v(a,r,h),y=B(d,n,h),A=Math.min(u.shares,y.shares);return{profit:A-(u.cost+y.cost),betA:u,betB:y,shares:A}};for(let h=0;h<100;h++){let u=(i+l)/2;if(u<=i||u>=l)break;let{profit:y}=o(u),A=(u+l)/2,{profit:c}=o(A);c>y?i=u:l=u}let f=(i+l)/2,{profit:p,betA:x,betB:g}=o(f),m=null;return p<=.01&&(m=`No profitable balanced arbitrage opportunity found: Profit M${p.toFixed(2)}`),{result:{marketA:t,marketB:e,betAmountA:x.cost,betAmountB:g.cost,profit:p,newProbability:f,betOutcomeA:"YES",betOutcomeB:"NO"},error:m}}function j(t,e){let a=t.pool.YES*t.pool.NO,d=e.pool.YES*e.pool.NO,r=t.probability,n=e.probability;if(r+n<=1)return{result:null,error:"Horse Race mode requires combined YES probability > 100%"};let i=0,l=1,o=.5;for(let h=0;h<100;h++){o=(i+l)/2;let u=1-o;if(o>=r||u>=n){l=o;continue}let{cost:y,shares:A}=B(a,r,o),{cost:c,shares:S}=B(d,n,u);S-y>A-c?l=o:i=o}let f=1-o,{cost:p}=B(a,r,o),{cost:x,shares:g}=B(d,n,f),m=g-p;return m<=.01?{result:null,error:"No profitable arbitrage opportunity found"}:{result:{marketA:t,marketB:e,betAmountA:p,betAmountB:x,profit:m,newProbabilityA:o,newProbabilityB:f,betOutcomeA:"NO",betOutcomeB:"NO"},error:null}}function G(t,e){let a=t.pool.YES*t.pool.NO,d=e.pool.YES*e.pool.NO,r=t.probability,n=e.probability;if(r>=n)return{result:{marketA:t,marketB:e,betAmountA:0,betAmountB:0,profit:0,newProbability:(r+n)/2,betOutcomeA:"YES",betOutcomeB:"NO"},error:`For 'oneSided' mode, Market A probability (${(r*100).toFixed(1)}%) must be lower than Market B probability (${(n*100).toFixed(1)}%) for a meaningful calculation`};let i=r,l=n,o=(i+l)/2,f=-1/0,p=0,x=0;for(let m=0;m<100&&(o=(i+l)/2,!(o<=i||o>=l));m++){let{cost:h,shares:u}=v(a,r,o),{cost:y}=B(d,n,o),A=u-y;A>f&&(f=A,p=h,x=y);let c=(o+l)/2,{shares:S}=v(a,r,c),{cost:C}=B(d,n,c);S-C>A?i=o:l=o}let g=null;return f<=.01&&(g=`No profitable oneSided arbitrage opportunity found: Profit M${f.toFixed(2)}`),{result:{marketA:t,marketB:e,betAmountA:p,betAmountB:x,profit:f,newProbability:o,betOutcomeA:"YES",betOutcomeB:"NO"},error:g}}function W(t,e){let a=t.pool.YES*t.pool.NO,d=e.pool.YES*e.pool.NO,r=t.probability,n=e.probability;if(r>=n)return{result:{marketA:t,marketB:e,betAmountA:0,betAmountB:0,profit:0,newProbability:(r+n)/2,betOutcomeA:"YES",betOutcomeB:"NO"},error:`For 'average' mode, Market A probability (${(r*100).toFixed(1)}%) must be lower than Market B probability (${(n*100).toFixed(1)}%) for a meaningful calculation`};let i=(r+n)/2,{cost:l,shares:o}=v(a,r,i),{cost:f,shares:p}=B(d,n,i),g=Math.min(o,p)-(l+f),m=null;return g<=.01&&(m=`No profitable average arbitrage opportunity found: Profit M${g.toFixed(2)}`),{result:{marketA:t,marketB:e,betAmountA:l,betAmountB:f,profit:g,newProbability:i,betOutcomeA:"YES",betOutcomeB:"NO"},error:m}}function z(){let[t,e]=M(""),[a,d]=M(""),[r,n]=M(""),[i,l]=M(25),[o,f]=M("average"),[p,x]=M(null),[g,m]=M(null),[h,u]=M(!1),[y,A]=M(!1),[c,S]=M(null),[C,w]=M(null);Y(()=>{let O=setTimeout(async()=>{let k=t.split("/").pop()?.trim();if(k){u(!0),w(null);try{let b=await fetch(`/api/v0/market/${k}`),E=await b.json();if(!b.ok)throw new Error(E.error||"Failed to fetch Market A");x(E)}catch(b){w(`Error fetching Market A: ${typeof b=="object"&&b!==null&&"message"in b?b.message:String(b)}`),x(null)}finally{u(!1)}}else x(null)},500);return()=>clearTimeout(O)},[t]),Y(()=>{let O=setTimeout(async()=>{let k=a.split("/").pop()?.trim();if(k){A(!0),w(null);try{let b=await fetch(`/api/v0/market/${k}`),E=await b.json();if(!b.ok)throw new Error(E.error||"Failed to fetch Market B");m(E)}catch(b){w(`Error fetching Market B: ${typeof b=="object"&&b!==null&&"message"in b?b.message:String(b)}`),m(null)}finally{A(!1)}}else m(null)},500);return()=>clearTimeout(O)},[a]),Y(()=>{if(p&&g){let{result:O,error:k}=F(p,g,o);S(O),w(k)}else S(null),!t&&!a&&w(null)},[p,g,o]),Y(()=>{l(25)},[c]);let q=c?(c.betAmountA+c.betAmountB)*(i/100):0,I=c?.betOutcomeA?`Market A (Bet ${c.betOutcomeA})`:"Market A",H=c?.betOutcomeB?`Market B (Bet ${c.betOutcomeB})`:"Market B",P="URL for first market",N="URL for second market";switch(o){case"balanced":P="URL for Market A (lower probability)",N="URL for Market B (higher probability)";break;case"oneSided":P="URL for Market A (lower probability)",N="URL for Market B (higher probability)";break;case"average":P="URL for Market A (lower probability)",N="URL for Market B (higher probability)";break;case"horseRace":P="URL for Market A",N="URL for Market B";break;default:P="URL for Market A",N="URL for Market B";break}return s("div",{class:"p-4 mx-auto max-w-screen-md text-gray-100",children:[s("h1",{class:"text-xl font-bold mb-1",children:"\u{1F99D} Arbitrage Calculator"}),s("p",{class:"mb-4 text-sm text-gray-400",children:"Find profit between two markets."}),s("div",{class:"flex flex-col md:flex-row gap-4",children:[s(L,{marketUrl:t,setMarketUrl:e,marketData:p,sideLabel:I,placeholder:P,isLoading:h}),s(L,{marketUrl:a,setMarketUrl:d,marketData:g,sideLabel:H,placeholder:N,isLoading:y})]}),s($,{mode:o,setMode:f}),s("div",{class:"mt-3",children:[s("label",{htmlFor:"api-key",class:"block text-sm font-medium text-gray-300",children:"Manifold API Key (optional)"}),s("p",{class:"text-xs text-gray-500 mt-1",children:"Generates additional options. We do not store this key"}),s("input",{type:"password",id:"api-key",name:"apiKey",value:r,onInput:O=>n(O.currentTarget.value),placeholder:"xxxxx-xxxx-xxxx-xxxxxxxxxxxxxxx",class:"mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-800 text-gray-100"}),s("p",{class:"mt-1 text-xs text-gray-400 text-right",children:"Find your API key on your Manifold profile page by clicking the gear icon and selecting Account Settings."})]}),s(T,{calculation:c,error:C,isLoading:h||y,budgetPercentage:i,mode:o}),c&&s(R,{children:[s(D,{budgetPercentage:i,setBudgetPercentage:l}),s("div",{class:"mt-6 border-t border-gray-700 pt-4",children:[s("div",{class:"flex justify-between items-center",children:[s("div",{children:[s("h3",{class:"text-base font-semibold text-white",children:"Execute Arbitrage"}),s("p",{class:"text-xs text-gray-500 mt-1",children:"Allows you to place a bet using your API key."})]}),s("p",{class:"text-sm text-gray-400",children:["Total Cost:"," ",s("span",{class:"font-bold text-white",children:["M",Math.round(q)]})]})]}),s(U,{calculation:c,apiKey:r,budgetPercentage:i})]})]})]})}export{z as default};
