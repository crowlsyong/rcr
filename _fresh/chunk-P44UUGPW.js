import{a as w}from"./chunk-I6W4WTVW.js";import{a as U}from"./chunk-DT2WSX4O.js";import{a as r}from"./chunk-MEABNXAK.js";import{a as n,b as p,c as E,e as b}from"./chunk-NGSZJRVL.js";import{d as m}from"./chunk-V66ALGLP.js";function j({debouncedUsername:i,onUserOverviewFetched:l,refreshTrigger:y}){let[D,d]=n(!1),[s,f]=n(null),[c,u]=n(null),[A,g]=n([]),S=E(!1);p(()=>{if(S.current){if(typeof window<"u"){let a=new URL(globalThis.location.href);i?a.searchParams.set("q",i):a.searchParams.delete("q"),globalThis.history.replaceState(null,"",a.toString())}}else S.current=!0},[i]);let x=b(async a=>{f(null),u(null),g([]),d(!0),console.log("[UserAdjustmentDisplay] Fetching data for:",a);try{let t=await fetch(`/api/v0/credit-score?username=${a}`),e=await t.json();if(!t.ok||!e.userExists){let o=e.error||`User @${a} not found.`;u(o),l(null),console.error("[UserAdjustmentDisplay] Fetch failed:",a,o);return}let h=[];if(e.userId){let o=await fetch(`/api/v0/history?userId=${e.userId}`);o.ok?(h=await o.json(),g(h)):console.error("Failed to fetch historical data for chart:",o.statusText)}let v={userExists:e.userExists,fetchSuccess:e.fetchSuccess,userId:e.userId,username:e.username,avatarUrl:e.avatarUrl,creditScore:e.creditScore,riskBaseFee:e.riskBaseFee,userDeleted:e.userDeleted,existingOverrideEvents:e.overrideEvents||[],allHistoricalData:h};f(v),l(v),console.log("[UserAdjustmentDisplay] User data fetched:",v)}catch(t){let e=`Error fetching user data: ${typeof t=="object"&&t!==null&&"message"in t?t.message:String(t)}`;u(e),l(null),console.error("[UserAdjustmentDisplay] Fetch error:",t)}finally{d(!1)}},[l]);return p(()=>{if(console.log("[UserAdjustmentDisplay] Data fetch effect triggered. Debounced username:",i,"Refresh Trigger:",y),!i){f(null),u(null),l(null),d(!1),g([]);return}x(i)},[i,y,x]),r(m,{children:[D&&r("p",{class:"text-gray-400 text-sm mt-2",children:"Loading user data..."}),c&&r("p",{class:"text-red-400 text-sm mt-2",children:c}),s&&!c&&r(m,{children:[r("div",{class:"p-4 bg-gray-800 rounded-lg border border-gray-700 mb-6",children:[r("h3",{class:"text-lg font-semibold text-white mb-2",children:"Current User Status:"}),r(U,{username:s.username,creditScore:s.creditScore,riskBaseFee:s.riskBaseFee,avatarUrl:s.avatarUrl,isWaiting:!1,userExists:s.userExists,fetchSuccess:s.fetchSuccess,isEmptyInput:!1,userDeleted:s.userDeleted})]}),s.allHistoricalData.length>0||s.existingOverrideEvents.length>0?r("div",{class:"bg-gray-900 rounded-lg",children:r(w,{username:s.username,historicalData:A,selectedTimeRange:"ALL",isLoading:D,error:c,overrideEvents:s.existingOverrideEvents,chartHeight:"200px"})}):r("div",{class:"bg-gray-900 p-4 md:p-6 rounded-lg shadow-inner border border-gray-700 mb-6",children:[r("h2",{class:"text-xl font-semibold mb-4 text-gray-100",children:"Score History"}),r("p",{class:"text-gray-400 text-sm text-center py-4",children:"No historical score or override data to display yet for this user."})]})]})]})}export{j as a};
