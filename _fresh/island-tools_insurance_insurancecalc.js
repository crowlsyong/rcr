import{a as K}from"./chunk-SELNUVPJ.js";import"./chunk-VKMAZ3AH.js";import"./chunk-HH3PC2H5.js";import"./chunk-XYXIYNE5.js";import"./chunk-SGICYE5O.js";import"./chunk-LVAMNDI2.js";import{a as V}from"./chunk-RLTKQPCS.js";import"./chunk-YW3YQVQS.js";import"./chunk-Q6UR6VXR.js";import"./chunk-CVKZWSML.js";import{a as L}from"./chunk-2U6NKMX2.js";import"./chunk-G66S4ZYY.js";import"./chunk-4B4WLAJN.js";import{b as e}from"./chunk-CRCKSX74.js";import"./chunk-GI7LLYGM.js";import"./chunk-HNGXSQHJ.js";import"./chunk-DT2WSX4O.js";import"./chunk-DGI52A4N.js";import"./chunk-URWAKGWD.js";import{a as l}from"./chunk-MEABNXAK.js";import{a as v,b}from"./chunk-NGSZJRVL.js";import{d as x}from"./chunk-V66ALGLP.js";var X="https://manifold.markets/crowlsyong/risk-payment-portal";function Z(){let u=e(""),f=e(""),i=e(0),p=e(null),c=e(""),g=e(""),I=e(""),y=e(null),T=e(""),E=e(!1),N=e(""),[R,O]=v(!1),j=e(null),[m,_]=v(null),[q,H]=v(null),[S,W]=v(0),[Y,J]=v(0),w=e(!1),h=e(!1),D=e(""),P=e(""),F=e(!1),a=e(""),t=e(""),M=e(null),s=e(!1),r=e(!1),C=e(""),k=e(!1),$=e(null);b(()=>{let n;return s.value&&(n=setTimeout(()=>s.value=!1,4e3)),()=>clearTimeout(n)},[s.value]),b(()=>{let n;return r.value&&(C.value="Woah! You just did that. Wait a sec before trying again.",n=setTimeout(()=>{r.value=!1,C.value=""},2e3)),()=>clearTimeout(n)},[r.value]);let U=n=>{if(!n)return"";let d=new Date(n+"T00:00:00");if(isNaN(d.getTime()))return"";let o=new Date(d);return o.setDate(d.getDate()+7),o.toISOString().split("T")[0]},z=async()=>{if(a.value="",t.value="",M.value=null,!c.value){a.value="Please enter your Manifold API Key.",t.value="error";return}if(!u.value||!f.value||!i.value||p.value===null||m===null||!g.value||!h.value||!w.value||D.value||P.value){a.value="Please fill in all required fields and resolve all errors.",t.value="error";return}F.value=!0,s.value=!1;try{let n={apiKey:c.value,borrowerUsername:u.value,lenderUsername:f.value,loanAmount:i.value,coverage:p.value,dueDate:g.value,partnerCode:T.value,lenderFee:y.value,managramMessage:I.value},d=await fetch("/api/v0/insurance/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),o=await d.json();if(!d.ok||!o.success)throw new Error(o.error||"An unknown error occurred.");a.value=o.message||"Insurance policy successfully created!",t.value="success",M.value=o.marketUrl||X,r.value=!0}catch(n){a.value=`Payment failed: ${typeof n=="object"&&n!==null&&"message"in n?n.message:String(n)}`,t.value="error",r.value=!0}finally{F.value=!1,s.value=!1}},G=()=>{if(!r.value){if(!B){a.value="Please fill in all required fields and resolve errors.",t.value="error";return}k.value?(a.value="To process with an institution, please use the 'Award Bounty & Pay RISK Fee' button in the Institutional Funding section.",t.value="error"):s.value?z():s.value=!0}},B=!!u.value&&!!f.value&&i.value>0&&p.value!==null&&m!==null&&!!g.value&&!P.value&&!!c.value&&w.value&&h.value&&!D.value,Q=m!==null?Math.round(m):0,A=i.value||0,ee=y.value!==null&&A>0?Math.round(A*(y.value/100)):0;return l(x,{children:[l("style",{children:`
        input[type="date"].custom-date-input::-webkit-calendar-picker-indicator {
          filter: invert(1);
        }
        .input-with-suffix {
          position: relative;
        }
        .input-with-suffix input {
          padding-right: 1.5rem;
        }
        .input-with-suffix::after {
          content: '%';
          position: absolute;
          right: 0.5rem;
          top: 50%;
          transform: translateY(-50%);
          color: #9CA3AF;
        }
        `}),l("div",{class:"w-full max-w-md mx-auto pb-6 px-0 sm:px-6 md:max-w-2xl lg:max-w-4xl",children:[l(K,{username:u,lenderUsername:f,loanAmount:i,selectedCoverage:p,loanDueDate:g,managramMessage:I,lenderFeePercentage:y,apiKey:c,handleApiKeyInput:n=>c.value=n.target.value,partnerCodeInput:T,partnerCodeValid:E,partnerCodeMessage:N,isCodeChecking:R,setIsCodeChecking:O,discountSource:j,insuranceFee:m,setInsuranceFee:_,initialInsuranceFeeBeforeDiscount:q,setInitialInsuranceFeeBeforeDiscount:H,riskBaseFee:S,setriskBaseFee:W,getPolicyEndDate:U,isLenderUsernameValid:w,isBorrowerUsernameValid:h,sameUserError:D,loanDueDateError:P,setDurationFee:J}),l(V,{apiKey:c,loanAmount:i,username:u,lenderUsername:f,managramMessage:I,insuranceFee:m,getPolicyEndDate:U,loanDueDate:g,selectedCoverage:p,riskBaseFee:S,partnerCodeValid:E,durationFee:Y,isProcessingPayment:F,paymentMessage:a,paymentMessageType:t,institution:$,cooldownActive:r,cooldownMessage:C,useInstitution:k}),!k.value&&l(L,{isFormValid:B,isProcessingPayment:F.value,isConfirming:s,cooldownActive:r,cooldownMessage:C,paymentMessage:a,paymentMessageType:t,paymentPortalLink:M,handleConfirmStepClick:G,currentInsuranceFee:Q,currentLoanAmount:A,usernameValue:u.value})]})]})}export{Z as default};
